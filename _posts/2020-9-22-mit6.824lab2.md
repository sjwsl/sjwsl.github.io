---
# layout: post
title: MIT 6.824 Lab2
categories: 
    - Lab Report
tag:
    - "6.824"
    - Golang
    - Distributed Systems
    - Raft
---

This is the first in a series of labs in which you'll build a fault-tolerant key/value storage system. In this lab you'll implement Raft, a replicated state machine protocol.

[Lab Homepage](http://nil.csail.mit.edu/6.824/2020/labs/lab-raft.html)

[Raft paper](https://pdos.csail.mit.edu/6.824/papers/raft-extended.pdf)

[TA's Guide](https://thesquareplanet.com/blog/students-guide-to-raft/)

## Part 2A

### Goal

Implement Raft leader election and heartbeats (AppendEntries RPCs with no log entries)

### Overview

Part 2A 要求实现 Raft 协议的 Leader 选举和心跳，满足论文中提到的 Election Safety。

### State

每个 Raft peer 需要维护基本信息，论文 Figure2 中与投票相关的状态，另外 `mu` 用于并发控制、`state` 表示 peer 的身份、`signal` 用于重置 Election Timeout。

```go
const (
	Leader State = iota
	Candidate
	Follower
)

type Raft struct {
	mu        sync.Mutex          // Lock to protect shared access to this peer's state
	peers     []*labrpc.ClientEnd // RPC end points of all peers
	persister *Persister          // Object to hold this peer's persisted state
	me        int                 // this peer's index into peers[]
	dead      int32               // set by Kill()
	currentTerm int
	votedFor    int
	state       State
	signal chan bool
}
```

### RPC

Part 2A 涉及两个 RPC `AppendEntires` 和 `RequestVote`

